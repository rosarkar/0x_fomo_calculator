<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cost of Inaction Calculator | 0x</title>
  <meta name="description" content="Calculate how much revenue your exchange loses by delaying token listings. Built by 0x.">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
  <style>
    @font-face {
      font-family: 'PolySans';
      src: local('PolySans'), local('Poly Sans');
      font-weight: 400;
      font-style: normal;
    }
    @font-face {
      font-family: 'PolySans';
      src: local('PolySans Medium'), local('Poly Sans Medium');
      font-weight: 500;
      font-style: normal;
    }
    @font-face {
      font-family: 'PolySans';
      src: local('PolySans Bold'), local('Poly Sans Bold');
      font-weight: 700;
      font-style: normal;
    }
    
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-family: 'PolySans', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; -webkit-font-smoothing: antialiased; }
    body { background: #fafafa; color: #18181b; line-height: 1.5; }
    
    .calculator-container { min-height: 100vh; padding: 0.75rem; }
    .calculator-inner { max-width: 80rem; margin: 0 auto; }
    
    .header { margin-bottom: 1rem; text-align: center; }
    .header h1 { font-size: 1.25rem; font-weight: 700; color: #09090b; margin-bottom: 0.25rem; }
    
    .card { background: #fff; border: 1px solid #e4e4e7; border-radius: 0.75rem; overflow: hidden; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    .card-layout { display: flex; flex-direction: column; }
    
    .control-panel { padding: 1rem; border-bottom: 1px solid #e4e4e7; background: rgba(250,250,250,0.5); }
    .control-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; }
    .control-header .dot { width: 8px; height: 8px; border-radius: 50%; background: #10b981; }
    .control-header h3 { font-size: 0.75rem; font-weight: 600; color: #3f3f46; text-transform: uppercase; letter-spacing: 0.05em; }
    .control-section { margin-bottom: 1.25rem; }
    .control-section:last-child { margin-bottom: 0; }
    
    .label { font-size: 0.75rem; color: #52525b; display: flex; align-items: center; gap: 0.375rem; margin-bottom: 0.5rem; }
    .label svg { width: 14px; height: 14px; }
    .label-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .value { font-family: ui-monospace, monospace; font-weight: 700; font-size: 0.875rem; }
    .value-emerald { color: #047857; }
    .value-amber { color: #b45309; }
    .value-blue { color: #1d4ed8; }
    .value-violet { color: #7c3aed; }
    
    .presets { display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.375rem; }
    .preset-btn { padding: 0.5rem 0.25rem; border-radius: 0.5rem; font-size: 0.7rem; font-weight: 500; display: flex; flex-direction: column; align-items: center; gap: 0.125rem; border: 1px solid #d4d4d8; background: #fff; color: #52525b; cursor: pointer; transition: all 0.2s; }
    .preset-btn:hover { background: #f4f4f5; color: #18181b; }
    .preset-btn.active { background: #09090b; color: #fff; border-color: #09090b; }
    .preset-btn .emoji { font-size: 1rem; }
    .preset-btn .preset-meta { font-size: 0.5625rem; color: #a1a1aa; margin-top: 0.125rem; white-space: nowrap; }
    .preset-btn.active .preset-meta { color: #a1a1aa; }
    
    input[type="range"] { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; background: #e4e4e7; border-radius: 4px; cursor: pointer; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: #18181b; box-shadow: 0 1px 3px rgba(0,0,0,0.2); cursor: pointer; }
    input[type="range"]::-moz-range-thumb { width: 18px; height: 18px; border-radius: 50%; background: #18181b; border: none; box-shadow: 0 1px 3px rgba(0,0,0,0.2); cursor: pointer; }
    .slider-emerald::-webkit-slider-thumb { background: #059669; }
    .slider-emerald::-moz-range-thumb { background: #059669; }
    .slider-amber::-webkit-slider-thumb { background: #d97706; }
    .slider-amber::-moz-range-thumb { background: #d97706; }
    .slider-blue::-webkit-slider-thumb { background: #2563eb; }
    .slider-blue::-moz-range-thumb { background: #2563eb; }
    .slider-violet::-webkit-slider-thumb { background: #7c3aed; }
    .slider-violet::-moz-range-thumb { background: #7c3aed; }
    
    .comp-markers { position: relative; height: 28px; margin-top: 0.5rem; background: linear-gradient(to right, rgba(239,68,68,0.05), rgba(239,68,68,0.02)); border-radius: 4px; padding: 4px 0; }
    .comp-marker { 
      position: absolute; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      transform: translateX(-50%); 
      cursor: grab;
      user-select: none;
      transition: transform 0.1s ease;
      z-index: 10;
    }
    .comp-marker:hover { transform: translateX(-50%) scale(1.15); }
    .comp-marker.dragging { 
      cursor: grabbing; 
      transform: translateX(-50%) scale(1.2);
      z-index: 20;
    }
    .comp-marker .dot { 
      width: 10px; 
      height: 10px; 
      border-radius: 50%; 
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
      border: 2px solid #fff;
    }
    .comp-marker .name { font-size: 8px; font-weight: 600; margin-top: 2px; white-space: nowrap; text-shadow: 0 1px 2px rgba(255,255,255,0.8); }
    .comp-marker .day-label { font-size: 7px; color: #71717a; font-weight: 500; }
    
    .drag-hint { font-size: 0.625rem; color: #a1a1aa; text-align: center; margin-top: 0.25rem; font-style: italic; }
    
    .copy-btn { width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.75rem 1rem; border-radius: 0.5rem; font-weight: 600; font-size: 0.875rem; border: 2px solid #d4d4d8; background: #fff; color: #3f3f46; cursor: pointer; transition: all 0.2s; }
    .copy-btn:hover { border-color: #a1a1aa; }
    .copy-btn.copied { background: #059669; color: #fff; border-color: #10b981; }
    .copy-btn svg { width: 16px; height: 16px; }
    
    .viz-panel { display: flex; flex-direction: column; background: #fff; }
    
    .result-section { padding: 1rem; background: linear-gradient(135deg, #fef2f2 0%, #fff7ed 100%); border-bottom: 1px solid #fee2e2; }
    .result-top { display: flex; flex-direction: column; gap: 1rem; }
    .result-main { flex-shrink: 0; }
    .result-label { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem; }
    .result-label svg { width: 24px; height: 24px; color: #dc2626; }
    .result-label span { font-size: 0.75rem; color: #52525b; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 500; }
    .result-value { font-family: ui-monospace, monospace; font-size: 3rem; font-weight: 700; color: #dc2626; letter-spacing: -0.05em; line-height: 1; }
    .result-subtitle { font-size: 0.875rem; color: #71717a; margin-top: 0.5rem; }
    
    .result-context { 
      flex: 1;
      padding: 0.75rem;
      background: rgba(255,255,255,0.7);
      border-radius: 0.5rem;
      border: 1px solid rgba(220, 38, 38, 0.15);
    }
    .result-context p { 
      font-size: 0.8125rem; 
      color: #52525b; 
      line-height: 1.6;
    }
    .result-context strong { color: #dc2626; font-weight: 600; }
    
    .stats { display: flex; flex-wrap: wrap; gap: 0.75rem; margin-top: 1rem; }
    .stat { padding: 0.5rem 1rem; border-radius: 0.5rem; text-align: center; background: #fff; border: 1px solid #e4e4e7; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    .stat.green { background: #ecfdf5; border-color: #a7f3d0; }
    .stat-label { font-size: 0.75rem; color: #71717a; }
    .stat.green .stat-label { color: #047857; }
    .stat-value { font-family: ui-monospace, monospace; font-size: 1.125rem; font-weight: 700; }
    .stat-value.red { color: #dc2626; }
    .stat-value.amber { color: #d97706; }
    .stat-value.green { color: #047857; }
    
    .chart-section { flex: 1; padding: 1rem; position: relative; }
    .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .chart-header h3 { font-size: 0.75rem; color: #71717a; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 500; }
    .chart-legend { display: flex; gap: 0.75rem; font-size: 0.75rem; }
    .chart-legend-item { display: flex; align-items: center; gap: 0.25rem; color: #71717a; }
    .chart-legend-dot { width: 8px; height: 8px; border-radius: 50%; }
    .chart-container { height: 200px; position: relative; }
    
    .chart-footer { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-top: 0.5rem; 
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .comp-legend { display: flex; flex-wrap: wrap; gap: 0.75rem; font-size: 0.75rem; }
    .comp-legend-item { display: flex; align-items: center; gap: 0.25rem; color: #52525b; }
    .comp-legend-item.faded { opacity: 0.4; }
    .comp-legend-line { width: 12px; height: 2px; }
    .comp-legend-x { color: #ef4444; font-weight: 700; margin-left: 2px; }
    
    .chart-watermark {
      font-size: 0.5625rem;
      color: #a1a1aa;
      font-weight: 500;
    }
    
    .cta-section { padding: 1rem; background: #fafafa; border-top: 1px solid #e4e4e7; display: flex; flex-direction: column; gap: 0.75rem; align-items: center; text-align: center; }
    .cta-text h4 { font-size: 0.875rem; font-weight: 600; color: #18181b; margin-bottom: 0.125rem; }
    .cta-text p { font-size: 0.75rem; color: #71717a; }
    .cta-btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: #09090b; color: #fff; font-weight: 600; font-size: 0.875rem; border-radius: 0.5rem; text-decoration: none; transition: background 0.2s; }
    .cta-btn:hover { background: #27272a; }
    .cta-btn svg { width: 16px; height: 16px; }
    
    .footer { text-align: center; font-size: 0.75rem; color: #a1a1aa; margin-top: 0.75rem; }
    .footer a { text-decoration: underline; color: #a1a1aa; }
    .footer a:hover { color: #52525b; }
    
    .text-input { width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d4d4d8; border-radius: 0.5rem; font-family: ui-monospace, monospace; font-size: 0.875rem; color: #18181b; background: #fff; display: none; }
    .text-input.show { display: block; }
    .text-input:focus { outline: none; border-color: #71717a; }
    
    @media (min-width: 768px) {
      .calculator-container { padding: 1.25rem; }
      .header h1 { font-size: 1.5rem; }
      .card-layout { flex-direction: row; }
      .control-panel { width: 35%; border-bottom: none; border-right: 1px solid #e4e4e7; padding: 1.25rem; }
      .viz-panel { width: 65%; }
      .result-section { padding: 1.25rem; text-align: left; }
      .result-top { flex-direction: row; align-items: flex-start; }
      .result-value { font-size: 4.5rem; }
      .result-label { justify-content: flex-start; }
      .result-context { margin-top: 0; }
      .stats { justify-content: flex-start; }
      .chart-section { padding: 1.25rem; }
      .chart-container { height: 220px; }
      .cta-section { flex-direction: row; justify-content: space-between; text-align: left; }
      .preset-btn { font-size: 0.75rem; }
      .preset-btn .preset-meta { font-size: 0.625rem; }
    }
  </style>
</head>
<body>
  <div class="calculator-container">
    <div class="calculator-inner">
      <div class="header">
        <h1>The Cost of Inaction</h1>
      </div>

      <div class="card">
        <div class="card-layout">
          <div class="control-panel">
            <div class="control-header">
              <div class="dot"></div>
              <h3>Control Panel</h3>
            </div>

            <div class="control-section">
              <div class="label">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                Quick Select Token
              </div>
              <div class="presets">
                <button class="preset-btn active" data-name="PEPE" data-volume="71" data-lag="18">
                  <span class="emoji">üê∏</span>
                  <span>PEPE</span>
                  <span class="preset-meta">18d ¬∑ $71M/d</span>
                </button>
                <button class="preset-btn" data-name="WIF" data-volume="45" data-lag="106">
                  <span class="emoji">üê∂</span>
                  <span>WIF</span>
                  <span class="preset-meta">106d ¬∑ $45M/d</span>
                </button>
                <button class="preset-btn" data-name="BONK" data-volume="25" data-lag="355">
                  <span class="emoji">üêï</span>
                  <span>BONK</span>
                  <span class="preset-meta">355d ¬∑ $25M/d</span>
                </button>
                <button class="preset-btn" data-name="POPCAT" data-volume="15" data-lag="428">
                  <span class="emoji">üôÄ</span>
                  <span>POPCAT</span>
                  <span class="preset-meta">428d ¬∑ $15M/d</span>
                </button>
                <button class="preset-btn" data-name="Custom" data-volume="" data-lag="">
                  <span class="emoji">‚úèÔ∏è</span>
                  <span>Custom</span>
                  <span class="preset-meta">Set yours</span>
                </button>
              </div>
              <input type="text" id="customToken" class="text-input" maxlength="10" placeholder="TOKEN" style="margin-top: 0.5rem;">
            </div>

            <div class="control-section">
              <div class="label-row">
                <span class="label">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                  Daily Volume
                </span>
                <span class="value value-emerald" id="volumeValue">$71M</span>
              </div>
              <input type="range" id="volumeSlider" class="slider-emerald" min="1" max="500" value="71">
            </div>

            <div class="control-section">
              <div class="label-row">
                <span class="label">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                  Your Listing Lag
                </span>
                <span class="value value-amber" id="lagValue">18 days</span>
              </div>
              <input type="range" id="lagSlider" class="slider-amber" min="1" max="600" value="18">
              <div class="comp-markers" id="compMarkers"></div>
              <p class="drag-hint">‚Üî Drag competitors to adjust their listing speed</p>
            </div>

            <div class="control-section">
              <div class="label-row">
                <span class="label">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" x2="5" y1="5" y2="19"/><circle cx="6.5" cy="6.5" r="2.5"/><circle cx="17.5" cy="17.5" r="2.5"/></svg>
                  Trading Fee
                </span>
                <span class="value value-blue" id="feeValue">0.10%</span>
              </div>
              <input type="range" id="feeSlider" class="slider-blue" min="5" max="100" value="10">
            </div>

            <div class="control-section">
              <div class="label-row">
                <span class="label">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                  Capture Rate
                </span>
                <span class="value value-violet" id="captureValue">15%</span>
              </div>
              <input type="range" id="captureSlider" class="slider-violet" min="1" max="100" value="15">
            </div>

            <button class="copy-btn" id="copyBtn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
              <span>Copy Memo for Leadership</span>
            </button>
          </div>

          <div class="viz-panel">
            <div class="result-section">
              <div class="result-top">
                <div class="result-main">
                  <div class="result-label">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/></svg>
                    <span>Revenue Lost on $<span id="tokenDisplay">PEPE</span></span>
                  </div>
                  <div class="result-value" id="lostRevenue">$191,700</div>
                  <p class="result-subtitle" id="subtitle">from $1.3B missed volume over 18 days</p>
                </div>
                <div class="result-context">
                  <p id="contextText">Every day you delay listing a trending token, competitors capture volume that would otherwise flow through your platform. This calculator models the <strong>fee revenue you forfeit</strong> during your listing lag window. The opportunity cost compounds as early momentum drives the majority of trading activity, often within the first 7-14 days of a token's lifecycle.</p>
                </div>
              </div>
              <div class="stats">
                <div class="stat">
                  <div class="stat-label">Per Day</div>
                  <div class="stat-value red" id="perDay">$10.7K</div>
                </div>
                <div class="stat">
                  <div class="stat-label">Volume Missed</div>
                  <div class="stat-value amber" id="volumeMissed">$1.3B</div>
                </div>
                <div class="stat green">
                  <div class="stat-label">With 0x</div>
                  <div class="stat-value green" id="with0x">+$192K</div>
                </div>
              </div>
            </div>

            <div class="chart-section">
              <div class="chart-header">
                <h3>Volume Capture Timeline</h3>
                <div class="chart-legend">
                  <div class="chart-legend-item"><div class="chart-legend-dot" style="background: #059669;"></div> Market</div>
                  <div class="chart-legend-item"><div class="chart-legend-dot" style="background: #2563eb;"></div> You</div>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="chart"></canvas>
              </div>
              <div class="chart-footer">
                <div class="comp-legend" id="compLegend"></div>
                <span class="chart-watermark">Powered by 0x ‚Ä¢ Data: CoinGecko / Exchange Announcements</span>
              </div>
            </div>
          </div>
        </div>

        <div class="cta-section">
          <div class="cta-text">
            <h4>Capture Day 1 volume without the listing process.</h4>
            <p>0x gives your users instant access to 9M+ tokens. No committee. No delays.</p>
          </div>
          <a href="https://0x.org/contact" target="_blank" rel="noopener noreferrer" class="cta-btn">
            Talk to Enterprise Team
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
          </a>
        </div>
        <div class="disclaimer" style="margin-top: 2rem; padding: 1rem; background: #f4f4f5; border-radius: 0.5rem; font-size: 0.75rem; color: #71717a; line-height: 1.6;">
          <strong>Key Assumptions & Limitations</strong>
          <ul style="margin-top: 0.5rem; padding-left: 1.25rem;">
          <li><strong>Dune Timeout Constraint</strong> ‚Äî Free Dune queries cap at 2 minutes, so granular daily breakdowns of daily volume after the first CEX listing wasn't feasible. Totals are accurate; the post-listing illustrative extrapolation.</li>
          <li><strong>Linear Average Simplification</strong> ‚Äî Because of the above, daily volumes are averaged linearly from total pre-listing DEX data. Real memecoin volume isn't linear as shown above. Best modeled as a mixture of lognormal PDFs to capture multiple hype waves.</li>
          <li><strong>Winner Bias Selection</strong> ‚Äî These presets (PEPE, WIF, BONK, POPCAT) are the 1-in-a-million survivors with massive volume over multiple rallies. Chosen deliberately for name recognition. CEX prospects know PEPE, so the "what if you missed this?" FOMO hits harder.</li>
          <li><strong>Conservative Inputs</strong> ‚Äî 0.1% fee, 15% capture rate, spot trading only. Real numbers vary by exchange tier and include derivatives upside not modeled here.</li>
          <li><strong>Illustrative Nature</strong> ‚Äî The above isn't a financial forecast or precise model. It's meant to be a conversation starter for the Content Manager panel interview.</li>
          </ul>
        </div>
      </div>

      <p class="footer">
        Calculations are illustrative. Competitor listing times are adjustable estimates.
        ¬∑ Built by <a href="https://0x.org" target="_blank" rel="noopener noreferrer">0x</a> ¬∑ $154B+ volume since 2017
      </p>
    </div>
  </div>

  <script>
    // Constants
    const SLIDER_MAX = 600;
    
    // Token-specific data with ACTUAL listing dates per token
    const tokenData = {
      PEPE: {
        volume: 71,
        lag: 18,
        competitors: [
          { name: 'Binance', day: 18, color: '#f59e0b' },
          { name: 'Bybit', day: 19, color: '#8b5cf6' },
          { name: 'Kraken', day: 565, color: '#0891b2' },
          { name: 'Coinbase', day: 577, color: '#2563eb' }
        ]
      },
      WIF: {
        volume: 45,
        lag: 106,
        competitors: [
          { name: 'Kraken', day: 90, color: '#0891b2' },
          { name: 'Binance', day: 106, color: '#f59e0b' },
          { name: 'Bybit', day: 161, color: '#8b5cf6' },
          { name: 'Coinbase', day: 359, color: '#2563eb' }
        ]
      },
      BONK: {
        volume: 25,
        lag: 355,
        competitors: [
          { name: 'Bybit', day: 10, color: '#8b5cf6' },
          { name: 'Coinbase', day: 354, color: '#2563eb' },
          { name: 'Binance', day: 355, color: '#f59e0b' }
        ]
      },
      POPCAT: {
        volume: 15,
        lag: 428,
        competitors: [
          { name: 'Bybit', day: 192, color: '#8b5cf6' },
          { name: 'Kraken', day: 282, color: '#0891b2' },
          { name: 'Coinbase', day: 428, color: '#2563eb' }
        ]
      },
      Custom: {
        volume: 50,
        lag: 30,
        competitors: [
          { name: 'Binance', day: 3, color: '#f59e0b' },
          { name: 'Bybit', day: 7, color: '#8b5cf6' },
          { name: 'Kraken', day: 14, color: '#0891b2' },
          { name: 'Coinbase', day: 21, color: '#2563eb' }
        ]
      }
    };
    
    // State
    let state = {
      dailyVolume: 71,
      listingLag: 18,
      tradingFee: 0.10,
      captureRate: 15,
      tokenName: 'PEPE',
      selectedPreset: 'PEPE'
    };

    // Active competitors array - starts with PEPE data
    let competitors = JSON.parse(JSON.stringify(tokenData.PEPE.competitors));

    let chart = null;
    let dragState = { isDragging: false, index: null, startX: 0, startDay: 0 };

    // Formatters
    function formatCurrency(value, compact = false) {
      if (compact) {
        if (value >= 1e9) return `$${(value / 1e9).toFixed(1)}B`;
        if (value >= 1e6) return `$${(value / 1e6).toFixed(1)}M`;
        if (value >= 1e3) return `$${(value / 1e3).toFixed(0)}K`;
        return `$${value.toFixed(0)}`;
      }
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(value);
    }

    // Calculations
    function calculate() {
      const lostRevenue = state.dailyVolume * 1_000_000 * state.listingLag * (state.captureRate / 100) * (state.tradingFee / 100);
      const totalMissedVolume = state.dailyVolume * state.listingLag * 1_000_000;
      return { lostRevenue, totalMissedVolume };
    }

    // Get dynamic max days for chart
    function getMaxChartDays() {
      const maxCompDay = Math.max(...competitors.map(c => c.day));
      return Math.max(90, state.listingLag + 30, maxCompDay + 30);
    }

    // Dynamic chart data
    function generateChartData() {
      const data = { labels: [], market: [], capture: [] };
      const maxDays = getMaxChartDays();
      const decay = maxDays > 200 ? 0.997 : (maxDays > 100 ? 0.995 : 0.98);
      
      for (let day = 0; day <= maxDays; day++) {
        data.labels.push(day);
        const market = day === 0 ? 0 : state.dailyVolume * ((1 - Math.pow(decay, day)) / (1 - decay));
        const capture = day > state.listingLag 
          ? (state.dailyVolume * ((1 - Math.pow(decay, day - state.listingLag)) / (1 - decay))) * (state.captureRate / 100) 
          : 0;
        data.market.push(market);
        data.capture.push(capture);
      }
      return data;
    }

    // UI Updates
    function updateUI() {
      const { lostRevenue, totalMissedVolume } = calculate();
      
      document.getElementById('volumeValue').textContent = `$${state.dailyVolume}M`;
      document.getElementById('lagValue').textContent = `${state.listingLag} days`;
      document.getElementById('feeValue').textContent = `${state.tradingFee.toFixed(2)}%`;
      document.getElementById('captureValue').textContent = `${state.captureRate}%`;
      document.getElementById('tokenDisplay').textContent = state.tokenName;
      document.getElementById('lostRevenue').textContent = formatCurrency(lostRevenue);
      document.getElementById('subtitle').textContent = `from ${formatCurrency(totalMissedVolume, true)} missed volume over ${state.listingLag} days`;
      document.getElementById('perDay').textContent = formatCurrency(lostRevenue / state.listingLag, true);
      document.getElementById('volumeMissed').textContent = formatCurrency(totalMissedVolume, true);
      document.getElementById('with0x').textContent = `+${formatCurrency(lostRevenue, true)}`;
      
      updateCompMarkers();
      updateCompLegend();
      updateChart();
    }

    function updateCompMarkers() {
      const container = document.getElementById('compMarkers');
      container.innerHTML = competitors.map((c, idx) => {
        const opacity = state.listingLag > c.day ? 1 : 0.4;
        const position = Math.min((c.day / SLIDER_MAX) * 100, 100);
        return `<div class="comp-marker" data-index="${idx}" style="left: ${position}%; opacity: ${opacity};">
          <div class="dot" style="background: ${c.color};"></div>
          <span class="name" style="color: ${c.color};">${c.name}</span>
          <span class="day-label">D${c.day}</span>
        </div>`;
      }).join('');
      
      container.querySelectorAll('.comp-marker').forEach(marker => {
        marker.addEventListener('mousedown', startDrag);
        marker.addEventListener('touchstart', startDrag, { passive: false });
      });
    }

    function updateCompLegend() {
      const container = document.getElementById('compLegend');
      const sortedComps = [...competitors].sort((a, b) => a.day - b.day);
      container.innerHTML = sortedComps.map(c => {
        const late = state.listingLag > c.day;
        return `<div class="comp-legend-item ${late ? '' : 'faded'}">
          <div class="comp-legend-line" style="background: ${late ? c.color : 'transparent'}; border-top: ${late ? 'none' : `1px dashed ${c.color}`};"></div>
          <span>${c.name} D${c.day}</span>
          ${late ? '<span class="comp-legend-x">‚úó</span>' : ''}
        </div>`;
      }).join('');
    }

    function updateChart() {
      const data = generateChartData();
      const maxDays = getMaxChartDays();
      
      const annotations = {};
      
      // Launch marker
      annotations.launchLine = {
        type: 'line',
        xMin: 0,
        xMax: 0,
        borderColor: '#10b981',
        borderWidth: 2
      };
      
      annotations.launchLabel = {
        type: 'label',
        xValue: 0,
        yValue: 'max',
        yAdjust: 25,
        xAdjust: 1,
        content: ['Launch'],
        color: '#10b981',
        font: { size: 9, weight: 'bold' },
        rotation: 270,
        position: { x: 'start', y: 'start' }
      };
      
      // Competitor lines - dynamically from current competitors array
      competitors.forEach((c, i) => {
        if (c.day <= maxDays) {
          const late = state.listingLag > c.day;
          annotations[`comp${i}`] = {
            type: 'line',
            xMin: c.day,
            xMax: c.day,
            borderColor: c.color,
            borderWidth: late ? 2 : 1,
            borderDash: late ? [] : [4, 4]
          };
          
          annotations[`compLabel${i}`] = {
            type: 'label',
            xValue: c.day,
            yValue: 'max',
            yAdjust: 25,
            xAdjust: 1,
            content: [c.name],
            color: c.color,
            font: { size: 9, weight: late ? 'bold' : 'normal' },
            rotation: 270,
            position: { x: 'start', y: 'start' }
          };
        }
      });
      
      // User's line
      if (state.listingLag <= maxDays) {
        annotations.userLine = {
          type: 'line',
          xMin: state.listingLag,
          xMax: state.listingLag,
          borderColor: '#dc2626',
          borderWidth: 2,
          borderDash: [6, 3]
        };
        
        annotations.userLabel = {
          type: 'label',
          xValue: state.listingLag,
          yValue: 'max',
          yAdjust: 25,
          xAdjust: 1,
          content: [`You: D${state.listingLag}`],
          color: '#dc2626',
          font: { size: 10, weight: 'bold' },
          rotation: 270,
          position: { x: 'start', y: 'start' }
        };
      }

      if (chart) {
        chart.data.labels = data.labels;
        chart.data.datasets[0].data = data.market;
        chart.data.datasets[1].data = data.capture;
        chart.options.plugins.annotation.annotations = annotations;
        chart.update('none');
      } else {
        const ctx = document.getElementById('chart').getContext('2d');
        chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.labels,
            datasets: [
              {
                label: 'Market Volume',
                data: data.market,
                borderColor: '#059669',
                backgroundColor: 'rgba(5, 150, 105, 0.1)',
                fill: true,
                tension: 0.4,
                pointRadius: 0
              },
              {
                label: 'Your Capture',
                data: data.capture,
                borderColor: '#2563eb',
                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                fill: true,
                tension: 0.4,
                pointRadius: 0
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { intersect: false, mode: 'index' },
            plugins: {
              legend: { display: false },
              annotation: { annotations },
              tooltip: {
                backgroundColor: '#fff',
                titleColor: '#18181b',
                bodyColor: '#71717a',
                borderColor: '#e4e4e7',
                borderWidth: 1,
                padding: 12,
                callbacks: {
                  title: ctx => `Day ${ctx[0].label}`,
                  label: ctx => `${ctx.dataset.label}: ${formatCurrency(ctx.raw * 1e6, true)}`
                }
              }
            },
            scales: {
              x: {
                grid: { color: '#f4f4f5' },
                ticks: { color: '#71717a', font: { size: 9 }, maxTicksLimit: 10 },
                title: { display: true, text: 'Days Since Launch', color: '#a1a1aa', font: { size: 10 } }
              },
              y: {
                grid: { color: '#f4f4f5' },
                ticks: { color: '#71717a', font: { size: 9 }, callback: v => `$${v}M` }
              }
            }
          }
        });
      }
    }

    // Drag handlers
    function startDrag(e) {
      e.preventDefault();
      const marker = e.currentTarget;
      const idx = parseInt(marker.dataset.index);
      const container = document.getElementById('compMarkers');
      const rect = container.getBoundingClientRect();
      const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
      
      dragState = {
        isDragging: true,
        index: idx,
        containerLeft: rect.left,
        containerWidth: rect.width
      };
      
      marker.classList.add('dragging');
      
      document.addEventListener('mousemove', onDrag);
      document.addEventListener('mouseup', endDrag);
      document.addEventListener('touchmove', onDrag, { passive: false });
      document.addEventListener('touchend', endDrag);
    }

    function onDrag(e) {
      if (!dragState.isDragging) return;
      e.preventDefault();
      
      const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
      const relativeX = clientX - dragState.containerLeft;
      const percentage = Math.max(0, Math.min(1, relativeX / dragState.containerWidth));
      const newDay = Math.max(1, Math.min(SLIDER_MAX, Math.round(percentage * SLIDER_MAX)));
      
      competitors[dragState.index].day = newDay;
      updateUI();
    }

    function endDrag() {
      if (!dragState.isDragging) return;
      document.querySelectorAll('.comp-marker').forEach(m => m.classList.remove('dragging'));
      dragState = { isDragging: false, index: null };
      
      document.removeEventListener('mousemove', onDrag);
      document.removeEventListener('mouseup', endDrag);
      document.removeEventListener('touchmove', onDrag);
      document.removeEventListener('touchend', endDrag);
    }

    function generateReport() {
      const { lostRevenue, totalMissedVolume } = calculate();
      const beaten = competitors.filter(c => c.day < state.listingLag);
      const sortedBeaten = [...beaten].sort((a, b) => a.day - b.day);
      const compLines = sortedBeaten.length > 0
        ? sortedBeaten.map(c => `  - ${c.name}: Listed Day ${c.day} (${state.listingLag - c.day} days ahead)`).join('\n')
        : '  - None. You beat all major competitors to market.';
      
      return `INTERNAL MEMO: OPPORTUNITY COST ANALYSIS
============================================

DATE: ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
PREPARED BY: Trading Infrastructure Team

ASSET ANALYZED
--------------
Token: ${state.tokenName}
Estimated Daily Launch Volume: ${formatCurrency(state.dailyVolume * 1e6, true)}
Your Listing Timeline: ${state.listingLag} days post-launch
Applied Trading Fee: ${state.tradingFee.toFixed(2)}%
Capture Rate Assumption: ${state.captureRate}%

REVENUE FOREGONE
----------------
Estimated Lost Fee Revenue: ${formatCurrency(lostRevenue)}
Total Missed Trading Volume: ${formatCurrency(totalMissedVolume, true)}
Daily Revenue Impact: ${formatCurrency(lostRevenue / state.listingLag, true)}/day

COMPETITIVE BENCHMARKS (${state.tokenName})
----------------------
Exchanges that listed before your Day ${state.listingLag} timeline:
${compLines}

All exchange listing dates for ${state.tokenName}:
${[...competitors].sort((a, b) => a.day - b.day).map(c => `  - ${c.name}: Day ${c.day}`).join('\n')}

RECOMMENDATION
--------------
Evaluate integration of hybrid trading infrastructure (e.g., 0x RFQ + AMM aggregation) to capture pre-listing volume without committee approval delays.

NEXT STEPS
----------
Contact 0x Enterprise Team: https://0x.org/contact
Documentation: https://0x.org/docs

============================================
Generated by 0x Cost of Inaction Calculator
Data Sources: CoinGecko, Exchange Announcements`;
    }

    // CRITICAL: Function to load token-specific competitor data
    function loadTokenCompetitors(tokenName) {
      if (tokenData[tokenName]) {
        // Deep copy to prevent mutation
        competitors = JSON.parse(JSON.stringify(tokenData[tokenName].competitors));
        console.log(`Loaded competitors for ${tokenName}:`, competitors);
      }
    }

    // Event Listeners
    document.querySelectorAll('.preset-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        // Update active state
        document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const name = btn.dataset.name;
        const volume = btn.dataset.volume;
        const lag = btn.dataset.lag;
        
        state.selectedPreset = name;
        
        if (name === 'Custom') {
          document.getElementById('customToken').classList.add('show');
          // Load default industry average competitors for custom
          loadTokenCompetitors('Custom');
          state.tokenName = 'TOKEN';
          state.dailyVolume = 50;
          state.listingLag = 30;
          document.getElementById('volumeSlider').value = 50;
          document.getElementById('lagSlider').value = 30;
        } else {
          document.getElementById('customToken').classList.remove('show');
          
          // Update state with preset values
          state.tokenName = name;
          state.dailyVolume = parseInt(volume);
          state.listingLag = parseInt(lag);
          
          // CRITICAL: Load the token-specific competitor data
          loadTokenCompetitors(name);
          
          // Update slider positions
          document.getElementById('volumeSlider').value = volume;
          document.getElementById('lagSlider').value = lag;
        }
        
        // Re-render everything
        updateUI();
      });
    });

    document.getElementById('customToken').addEventListener('input', e => {
      state.tokenName = e.target.value.toUpperCase() || 'TOKEN';
      updateUI();
    });

    document.getElementById('volumeSlider').addEventListener('input', e => {
      state.dailyVolume = parseInt(e.target.value);
      // Switch to custom but keep current competitors
      document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
      document.querySelector('.preset-btn[data-name="Custom"]').classList.add('active');
      document.getElementById('customToken').classList.add('show');
      state.selectedPreset = 'Custom';
      updateUI();
    });

    document.getElementById('lagSlider').addEventListener('input', e => {
      state.listingLag = parseInt(e.target.value);
      // Switch to custom but keep current competitors
      document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
      document.querySelector('.preset-btn[data-name="Custom"]').classList.add('active');
      document.getElementById('customToken').classList.add('show');
      state.selectedPreset = 'Custom';
      updateUI();
    });

    document.getElementById('feeSlider').addEventListener('input', e => {
      state.tradingFee = parseInt(e.target.value) / 100;
      updateUI();
    });

    document.getElementById('captureSlider').addEventListener('input', e => {
      state.captureRate = parseInt(e.target.value);
      updateUI();
    });

    document.getElementById('copyBtn').addEventListener('click', () => {
      const report = generateReport();
      navigator.clipboard.writeText(report).then(() => {
        const btn = document.getElementById('copyBtn');
        btn.classList.add('copied');
        btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6 9 17l-5-5"/></svg><span>Copied to Clipboard</span>`;
        setTimeout(() => {
          btn.classList.remove('copied');
          btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg><span>Copy Memo for Leadership</span>`;
        }, 3000);
      });
    });

    // Initialize
    updateUI();
  </script>
</body>
</html>
